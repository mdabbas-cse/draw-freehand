{"version":3,"file":"draw-freehand.umd.js","sources":["../src/Freehand.js"],"sourcesContent":["\nexport default class Freehand {\n\n  #canvas = null\n\n  #isDrawing = false\n\n  #penSize = null\n\n  #penColor = null\n\n  #penType = null\n\n  #penOpacity = null\n\n  #penFlow = null\n\n  #penHardness = null\n\n  #backgroundColor = null\n\n  #imageFormat = null\n\n  #snapShot = null\n\n  // self uses variables\n  #prevMouseX = null\n  #prevMouseY = null\n\n  #ctx = null\n\n  toolType = null\n\n  ratio = null\n\n  #imageFormats = {\n    'image/png': 'png',\n    'image/jpeg': 'jpg'\n  }\n\n  #pathArr = []\n\n  #countIndex\n\n  constructor(canvas, options = {}) {\n    try {\n\n      if (typeof canvas === 'string') {\n        this.#canvas = this.#select(canvas)\n      } else {\n        this.#canvas = canvas\n      }\n\n    } catch (error) {\n      console.error('Please provide canvas selector or canvas element')\n    }\n    this.#canvas.style.cursor = \"url('./img/pen.ico'), crosshair\"\n\n    this.#setDefaults(options)\n\n    this.init()\n  }\n\n  #setDefaults(options) {\n    this.#penSize = options?.penSize || 3\n    this.#penColor = options?.penColor || '#000000'\n    this.#penType = options?.penType || 'round'\n    this.#penOpacity = options?.penOpacity || 1\n    this.#penFlow = options?.penFlow || 1\n    this.#penHardness = options?.penHardness || 1\n    this.#backgroundColor = options?.backgroundColor || '#ffffff'\n    this.toolType = options?.toolType || 'brush' // brush, eraser\n    this.#imageFormat = options?.imageFormat || 'image/png'\n  }\n\n  init() {\n    this.#prevMouseX = 0\n    this.#prevMouseY = 0\n    this.#countIndex = -1\n    this.#isDrawing = false\n\n    // call resizeCanvas() on window resize\n    window.addEventListener('resize', this.resizeCanvas.bind(this))\n    window.addEventListener('load', this.resizeCanvas.bind(this))\n\n    this.#ctx = this.#canvas.getContext('2d', { willReadFrequently: true })\n    this.#ctx.scale(this.ratio, this.ratio)\n\n    this.#setCanvasBackground()\n\n    this.#ctx.fillStyle = this.#penColor\n\n\n    this.#canvas.addEventListener('mousedown', this.#startDrawing.bind(this))\n    this.#canvas.addEventListener('touchstart', this.#startDrawing.bind(this))\n\n    this.#canvas.addEventListener('mousemove', this.#draw.bind(this))\n    this.#canvas.addEventListener('touchmove', this.#draw.bind(this))\n\n    this.#canvas.addEventListener('mouseup', this.#stopDrawing.bind(this))\n    this.#canvas.addEventListener('touchend', this.#stopDrawing.bind(this))\n\n    this.#select('#clear')?.addEventListener('click', this.clear)\n\n    window.addEventListener('keydown', (e) => {\n      // for undo with ctrl+z\n      if (e.ctrlKey && e.key === 'z') {\n        this.undo()\n      }\n\n      // for redo with ctrl+y\n      if (e.ctrlKey && e.key === 'y') {\n        this.redo()\n      }\n\n      // for download with ctrl+s\n      if (e.ctrlKey && e.key === 's') {\n        e.preventDefault()\n        this.download()\n      }\n\n      // for clear with ctrl+d\n      if (e.ctrlKey && e.key === 'd') {\n        e.preventDefault()\n        this.clear()\n      }\n\n    })\n  }\n\n  #select = selector => document.querySelector(selector)\n\n  resizeCanvas() {\n    const ratio = Math.max(window.devicePixelRatio || 1, 1);\n    this.#canvas.width = this.#canvas.offsetWidth * ratio;\n    this.#canvas.height = this.#canvas.offsetHeight * ratio;\n    this.ratio = ratio\n  }\n\n  #setCanvasBackground() {\n    // setting whole canvas background to white, so the downloaded img background will be white\n    this.#ctx.fillStyle = \"#fff\";\n    this.#ctx.fillRect(0, 0, this.#canvas.width, this.#canvas.height);\n    this.#ctx.fillStyle = this.#backgroundColor; // setting fillstyle back to the selectedColor, it'll be the brush color\n  }\n\n  #draw(e) {\n    if (!this.#isDrawing) return\n    this.#ctx.putImageData(this.#snapShot, 0, 0)\n    const { offsetX, offsetY } = e\n\n    this.#ctx.strokeStyle = this.toolType === 'brush' ? this.#penColor : this.#backgroundColor\n    this.#ctx.lineTo(offsetX, offsetY)\n    this.#ctx.stroke()\n    this.#ctx.moveTo(offsetX, offsetY)\n\n    // for straight line\n    if (this.toolType === 'line') {\n      this.#ctx.beginPath()\n      this.#ctx.moveTo(this.#prevMouseX, this.#prevMouseY)\n      this.#ctx.lineTo(offsetX, offsetY)\n      this.#ctx.stroke()\n    }\n\n  }\n\n  #stopDrawing() {\n    this.#isDrawing = false\n    this.#ctx.beginPath()\n    this.#storePaths()\n  }\n\n  #startDrawing(e) {\n    this.#isDrawing = true\n    // set line color\n    this.#ctx.strokeStyle = this.#penColor\n    // set line cap\n    this.#ctx.lineCap = this.#penType\n    // line join\n    this.#ctx.lineJoin = 'round'\n    // set line opacity\n    this.#ctx.globalAlpha = this.#penOpacity\n    // set line flow\n    this.#ctx.globalCompositeOperation = this.#penFlow\n    // set line hardness\n    this.#ctx.miterLimit = this.#penHardness\n\n    // set previous mouse position\n    this.#prevMouseX = e.offsetX\n    this.#prevMouseY = e.offsetY\n\n    // set line width\n    this.#ctx.lineWidth = this.#penSize\n\n    // set line color\n    this.#ctx.strokeStyle = this.#penColor\n    this.#ctx.fillStyle = this.#backgroundColor\n\n    // set line cap\n    this.#snapShot = this.#ctx.getImageData(0, 0, this.#canvas.width, this.#canvas.height)\n    // create new path\n    this.#ctx.beginPath()\n\n    this.#draw(e)\n  }\n\n  #storePaths() {\n    this.#pathArr.push(this.#ctx.getImageData(0, 0, this.#canvas.width, this.#canvas.height))\n    this.#countIndex += 1\n  }\n\n  clear() {\n    if (this.#pathArr.length === 0) return\n    this.#ctx.clearRect(0, 0, this.#canvas.width, this.#canvas.height)\n    this.#setCanvasBackground()\n    this.#pathArr = []\n    this.#countIndex = -1\n  }\n\n  undo() {\n    if (this.#countIndex <= 0) {\n      this.clear()\n      return\n    }\n    this.#countIndex -= 1\n    // this.#pathArr.pop()\n    this.#ctx.putImageData(this.#pathArr[this.#countIndex], 0, 0)\n  }\n\n  redo() {\n    if (this.#countIndex >= this.#pathArr.length - 1) {\n      return\n    }\n    this.#countIndex += 1\n    this.#ctx.putImageData(this.#pathArr[this.#countIndex], 0, 0)\n  }\n\n  setToolType(toolType) {\n    this.toolType = toolType\n  }\n\n  setPenSize(size) {\n    this.#penSize = size\n  }\n\n  setPenColor(color) {\n    this.#penColor = color\n  }\n\n  setPenType(type) {\n    this.#penType = type\n  }\n\n  setPenOpacity(opacity) {\n    this.#penOpacity = opacity\n  }\n\n  setPenFlow(flow) {\n    this.#penFlow = flow\n  }\n\n  setPenHardness(hardness) {\n    this.#penHardness = hardness\n  }\n\n  setBackgroundColor(color) {\n    this.#backgroundColor = color\n  }\n\n  setImageFormat(imageFormat) {\n    this.#imageFormat = imageFormat\n  }\n\n  getImageString() {\n    return this.#canvas.toDataURL(this.#imageFormat)\n  }\n\n  download(filename) {\n    const data = this.getImageString()\n    const blob = this.#dataURLToBlob(data)\n    const url = window.URL.createObjectURL(blob)\n\n    const a = document.createElement(\"a\");\n    a.style = \"display: none\";\n    a.download = Date.now() + '.' + this.#imageFormats[this.#imageFormat]; // passing current date as link download value\n    a.href = url\n    document.body.appendChild(a);\n    a.click();\n    window.URL.revokeObjectURL(url);\n  }\n\n  #dataURLToBlob(dataURL) {\n    const parts = dataURL.split(';base64,');\n    const contentType = parts[0].split(\":\")[1];\n    const raw = window.atob(parts[1]);\n    const rawLength = raw.length;\n    const uInt8Array = new Uint8Array(rawLength);\n\n    for (let i = 0; i < rawLength; ++i) {\n      uInt8Array[i] = raw.charCodeAt(i);\n    }\n\n    return new Blob([uInt8Array], { type: contentType });\n  }\n\n  #download(dataURL, filename) {\n    const blob = dataURLToBlob(dataURL);\n    const url = window.URL.createObjectURL(blob);\n\n    imageUrl.href = url\n    imageUrl.innerText = filename\n\n    const a = document.createElement(\"a\");\n    a.style = \"display: none\";\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    window.URL.revokeObjectURL(url);\n  }\n\n  destroy() {\n    this.#canvas = null\n    this.#isDrawing = null\n    this.#ctx = null\n  }\n\n  // events\n  addEventListener(event, callback) {\n    this.#canvas.addEventListener(event, callback)\n  }\n\n  getCanvasData() {\n    return this.#canvas.toDataURL(this.#imageFormat)\n  }\n}\n"],"names":["canvas","isDrawing","penSize","penColor","penType","penOpacity","penFlow","penHardness","backgroundColor","imageFormat","snapShot","prevMouseX","prevMouseY","ctx","toolType","ratio","imageFormats","pathArr","countIndex","constructor","options","this","select","error","console","style","cursor","setDefaults","init","window","addEventListener","resizeCanvas","bind","getContext","willReadFrequently","scale","setCanvasBackground","fillStyle","startDrawing","draw","stopDrawing","clear","e","ctrlKey","key","undo","redo","preventDefault","download","selector","document","querySelector","Math","max","devicePixelRatio","width","offsetWidth","height","offsetHeight","fillRect","putImageData","offsetX","offsetY","strokeStyle","lineTo","stroke","moveTo","beginPath","storePaths","lineCap","lineJoin","globalAlpha","globalCompositeOperation","miterLimit","lineWidth","getImageData","push","length","clearRect","setToolType","setPenSize","size","setPenColor","color","setPenType","type","setPenOpacity","opacity","setPenFlow","flow","setPenHardness","hardness","setBackgroundColor","setImageFormat","getImageString","toDataURL","filename","data","blob","dataURLToBlob","url","URL","createObjectURL","a","createElement","Date","now","href","body","appendChild","click","revokeObjectURL","dataURL","parts","split","contentType","raw","atob","rawLength","uInt8Array","Uint8Array","i","charCodeAt","Blob","imageUrl","innerText","destroy","event","callback","getCanvasData"],"mappings":"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"}